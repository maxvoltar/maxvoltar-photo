<script>
  const ESCAPE = 27;
  const RIGHT = 39;
  const LEFT = 37;

  const clickButton = (buttonClass) => {
    const id = window.location.hash && window.location.hash.replace(".", "\\.");
    const selector = `li${id} ${buttonClass}`;
    const button = document.querySelector(selector);
    button && button.click();
  }

  const navigate = (destination) => {
    const link = document.querySelector("[href='" + destination + "']");
    const title = link.getAttribute('title');
    const anchor = destination;
    const path = anchor.replace('#', '').replace('.jpg', '');
    const href = `/${path}/${anchor}`;
    document.title = title;
    window.location = anchor;
    window.history.replaceState({}, title, href);
  }

  const navigationButton = (event, buttonClass, property) => {
    if (event.target.matches(buttonClass)) {
      const sibling = event.target.closest("li")[property];
      if (sibling) {
        const id = `#${sibling.getAttribute('id')}`;
        navigate(id);
        console.log(`Going to ${buttonClass}: ${id}`);
      }
      event.preventDefault();
    }
  }

  const openPhoto = (event, buttonClass) => {
    if (event.target.matches(buttonClass)) {
      navigate(event.target.getAttribute('href'));
      event.preventDefault();
    }
  }

  document.addEventListener("keydown", (event) => {
    if (event.keyCode === ESCAPE) {
      window.location = '#home';
      console.log('Going #home');
    } else if (event.keyCode === RIGHT) {
      clickButton('.next');
    } else if (event.keyCode === LEFT) {
      clickButton('.previous');
    }
  });

  document.addEventListener('click', (event) => {
    navigationButton(event, '.next', 'nextElementSibling');
    navigationButton(event, '.previous', 'previousElementSibling');
    openPhoto(event, '.open')
  });

  lazyload();
  </script>
